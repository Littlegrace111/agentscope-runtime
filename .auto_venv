# 自动虚拟环境检测和激活
# 将此文件内容添加到您的 ~/.zshrc 或 ~/.bashrc 中

# 检查是否在项目目录中
check_and_activate_venv() {
    # 检查当前目录是否包含 .python-version 文件
    if [ -f ".python-version" ] && [ -d "venv" ]; then
        # 检查虚拟环境是否已激活
        if [ -z "$VIRTUAL_ENV" ]; then
            echo "🐍 检测到 Python 项目，正在激活虚拟环境..."
            source venv/bin/activate
            echo "✅ 虚拟环境已激活: $(python --version)"
        fi
    elif [ -n "$VIRTUAL_ENV" ] && [ ! -f ".python-version" ]; then
        # 如果离开了项目目录，停用虚拟环境
        echo "🚪 离开项目目录，停用虚拟环境..."
        deactivate
    fi
}

# 在每次命令提示符显示前执行检查
if [[ "$PS1" ]]; then
    PROMPT_COMMAND="check_and_activate_venv; $PROMPT_COMMAND"
fi
